# è¯­è¨€æ£€æµ‹æŒä¹…åŒ–é—®é¢˜ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¥æœŸ**: 2025-10-27
**é—®é¢˜ç±»å‹**: æ•°æ®æŒä¹…åŒ–ç¼ºå¤± - è¯­è¨€æ£€æµ‹ç»“æœæœªä¿å­˜åˆ°æ•°æ®åº“
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜ï¼ˆæ ¸å¿ƒåŠŸèƒ½å¤±æ•ˆï¼‰
**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ“‹ é—®é¢˜æè¿°

### ç”¨æˆ·æŠ¥å‘Š

**é—®é¢˜è¡¨ç°**:
- âœ… ç”¨æˆ·è¾“å…¥ï¼šä¸­æ–‡
- âœ… ç³»ç»Ÿè¾“å‡ºï¼šä¸­æ–‡ Sora Prompt
- âŒ è¯­è¨€é€‰æ‹©å™¨æ˜¾ç¤ºï¼š**English**
- âŒ ç³»ç»Ÿæœªæ­£ç¡®åæ˜ æ£€æµ‹åˆ°çš„è¯­è¨€

**OpenAI æ—¥å¿—è¯æ®**:
```
Input: ä¸¤ä¸ªå¥³äººåšçˆ±
Output: zh  â† è¯­è¨€æ£€æµ‹æˆåŠŸæ‰§è¡Œï¼Œè¿”å› 'zh'

ä½†æ˜¯ï¼š
è¯­è¨€é€‰æ‹©å™¨ä»æ˜¾ç¤º "English" âŒ
```

**ç”¨æˆ·å›°æƒ‘**:
```
ç”¨æˆ·å¿ƒç†æµç¨‹:
1. è¾“å…¥ä¸­æ–‡ âœ“
2. çœ‹åˆ°ä¸­æ–‡è¾“å‡º âœ“
3. çœ‹åˆ°"English"é€‰æ‹©å™¨ âŒ â† ä¸ç¬¦åˆé¢„æœŸ
4. æ€€ç–‘ç³»ç»Ÿï¼š"æ£€æµ‹åˆ°è¯­è¨€äº†å—ï¼Ÿ"
5. æ„Ÿåˆ°å›°æƒ‘ï¼š"ä¸ºä»€ä¹ˆæ˜¾ç¤ºè‹±æ–‡ï¼Ÿ"
```

---

## ğŸ” æ ¹å› åˆ†æ

### é—®é¢˜æ—¶é—´çº¿

#### âœ… é˜¶æ®µ 1: è¯­è¨€æ£€æµ‹ï¼ˆæ­£å¸¸ï¼‰

**OpenAI æ—¥å¿—æ˜¾ç¤º**:
```
è¯·æ±‚: detectLanguage
è¾“å…¥: "ä¸¤ä¸ªå¥³äººåšçˆ±"
è¾“å‡º: "zh" âœ…

ç»“è®º: è¯­è¨€æ£€æµ‹é€»è¾‘æ­£å¸¸å·¥ä½œ
```

**ä»£ç æµç¨‹**:
```typescript
// src/lib/openai.ts Line 103-111
export async function detectLanguageClient(text: string): Promise<SupportedLanguage> {
  try {
    const result = await callEdgeFunction('detectLanguage', { text });
    return result as SupportedLanguage; // âœ… è¿”å› 'zh'
  } catch (error) {
    console.error('AI language detection failed, defaulting to en:', error);
    return 'en';
  }
}
```

**éªŒè¯**: âœ… è¯­è¨€æ£€æµ‹æ‰§è¡ŒæˆåŠŸ

---

#### âœ… é˜¶æ®µ 2: å‚æ•°ä¼ é€’ï¼ˆæ­£å¸¸ï¼‰

**è°ƒç”¨é“¾**:
```typescript
// PromptInput ç»„ä»¶
detectLanguageClient(input)
â†’ detectedLanguage = 'zh' âœ…

// ä¼ é€’ç»™ Dashboard
handleGenerate(
  input,
  mode,
  language,
  detectedLanguage  // âœ… 'zh' æ­£ç¡®ä¼ é€’
)

// Dashboard â†’ promptGenerator
generateSoraPrompt(
  input,
  mode,
  outputLanguage,
  detectedInputLanguage,  // âœ… 'zh' æ­£ç¡®ä¼ é€’
  userId
)
```

**éªŒè¯**: âœ… å‚æ•°ä¼ é€’é“¾è·¯å®Œæ•´

---

#### âŒ é˜¶æ®µ 3: æ•°æ®æŒä¹…åŒ–ï¼ˆå¤±è´¥ï¼‰â­â­â­

**é—®é¢˜ä»£ç ** (`src/lib/promptGenerator.ts` Line 27-37):

```typescript
// âŒ åˆ›å»º promptData æ—¶é—æ¼äº†è¯­è¨€å­—æ®µ
const promptData: Omit<Prompt, 'id'> = {
  user_id: userId,
  user_input: userInput,
  generated_prompt: prompt,
  intent_data: intentData,
  style_data: styleData,
  quality_score: qualityScore,
  mode,
  // âŒ ç¼ºå°‘ detected_input_language
  // âŒ ç¼ºå°‘ output_language
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
};
```

**å…³é”®é—®é¢˜**:
```
è™½ç„¶å‡½æ•°æ¥æ”¶äº†è¿™ä¸¤ä¸ªå‚æ•°:
- detectedInputLanguage: 'zh' âœ“
- outputLanguage: 'zh' âœ“

ä½†æ˜¯åœ¨åˆ›å»º promptData å¯¹è±¡æ—¶:
- æ²¡æœ‰å°†è¿™ä¸¤ä¸ªå€¼èµ‹ç»™å¯¹è±¡å±æ€§ âŒ
- å¯¼è‡´ä¿å­˜åˆ°æ•°æ®åº“æ—¶ä¸¢å¤± âŒ
```

**æ•°æ®æµæ–­è£‚ç‚¹**:
```
å‡½æ•°å‚æ•°
â”œâ”€ detectedInputLanguage: 'zh' âœ“
â””â”€ outputLanguage: 'zh' âœ“
   â†“
promptData å¯¹è±¡
â”œâ”€ user_input: '...' âœ“
â”œâ”€ generated_prompt: '...' âœ“
â”œâ”€ detected_input_language: undefined âŒ â† æ–­è£‚ç‚¹ï¼
â””â”€ output_language: undefined âŒ â† æ–­è£‚ç‚¹ï¼
   â†“
æ•°æ®åº“ä¿å­˜
â”œâ”€ detected_input_language: NULL âŒ
â””â”€ output_language: NULL âŒ
   â†“
å‰ç«¯è¯»å–
â”œâ”€ prompt.detected_input_language: undefined âŒ
â””â”€ prompt.output_language: undefined âŒ
   â†“
è¯­è¨€é€‰æ‹©å™¨
â”œâ”€ æ£€æµ‹åˆ°çš„è¯­è¨€: undefined âŒ
â”œâ”€ å›é€€åˆ° localStorage: 'en' æˆ– undefined
â””â”€ æœ€ç»ˆæ˜¾ç¤º: 'en' (English) âŒ
```

**éªŒè¯**: âŒ æ•°æ®æŒä¹…åŒ–ç¼ºå¤±

---

### ä¸ºä»€ä¹ˆä¹‹å‰çš„ä¿®å¤æ²¡æœ‰è§£å†³é—®é¢˜ï¼Ÿ

#### ä¿®å¤ 1: å®Œå–„ TypeScript ç±»å‹ï¼ˆLine 42-43ï¼‰

```typescript
// âœ… å·²æ·»åŠ ç±»å‹å®šä¹‰
export type Prompt = {
  // ...
  detected_input_language?: string;  // âœ… ç±»å‹å®šä¹‰å®Œæ•´
  output_language?: string;          // âœ… ç±»å‹å®šä¹‰å®Œæ•´
  // ...
};
```

**çŠ¶æ€**: âœ… ç±»å‹å®‰å…¨é—®é¢˜å·²è§£å†³
**æ•ˆæœ**: æä¾›äº†ç±»å‹æ£€æŸ¥ï¼Œä½†ä¸å½±å“è¿è¡Œæ—¶è¡Œä¸º
**é—®é¢˜**: TypeScript å…è®¸å¯é€‰å­—æ®µä¸º `undefined`ï¼Œä¸ä¼šæŠ¥é”™ âŒ

---

#### ä¿®å¤ 2: è‡ªåŠ¨æ£€æµ‹é€»è¾‘ï¼ˆPromptResult ç»„ä»¶ï¼‰

```typescript
// âœ… å·²æ·»åŠ è‡ªåŠ¨æ£€æµ‹
const [selectedLanguage] = useState(() => {
  const detectedLang = prompt.detected_input_language || prompt.output_language;
  // ...
});
```

**çŠ¶æ€**: âœ… æ£€æµ‹é€»è¾‘å·²å®ç°
**æ•ˆæœ**: èƒ½å¤Ÿè¯»å–æ•°æ®åº“ä¸­çš„è¯­è¨€å­—æ®µ
**é—®é¢˜**: æ•°æ®åº“å­—æ®µä¸ºç©ºï¼Œè¯»å–ä¸åˆ°æ•°æ® âŒ

---

### å®Œæ•´é—®é¢˜é“¾æ¡

```
1. è¯­è¨€æ£€æµ‹æ‰§è¡Œ âœ…
   â””â”€> è¿”å› 'zh' âœ…

2. å‚æ•°ä¼ é€’ âœ…
   â””â”€> detectedInputLanguage = 'zh' âœ…

3. æ•°æ®æŒä¹…åŒ– âŒ â† é—®é¢˜æ ¹æº
   â””â”€> promptData æœªåŒ…å«è¯­è¨€å­—æ®µ âŒ
   â””â”€> ä¿å­˜åˆ°æ•°æ®åº“æ—¶ä¸¢å¤± âŒ

4. å‰ç«¯è¯»å– âŒ
   â””â”€> prompt.detected_input_language = undefined âŒ
   â””â”€> è‡ªåŠ¨æ£€æµ‹å¤±è´¥ âŒ

5. UI æ˜¾ç¤º âŒ
   â””â”€> è¯­è¨€é€‰æ‹©å™¨æ˜¾ç¤º 'en' (English) âŒ
```

**ç»“è®º**: **æ•°æ®æŒä¹…åŒ–ç¼ºå¤±æ˜¯é—®é¢˜çš„æ ¹æœ¬åŸå› ** â­â­â­

---

## ğŸ›  ä¿®å¤æ–¹æ¡ˆ

### âœ… æ·»åŠ è¯­è¨€å­—æ®µåˆ° promptData

**ä¿®å¤ä»£ç ** (`src/lib/promptGenerator.ts` Line 27-39):

```typescript
// âœ… å®Œæ•´çš„ promptData å¯¹è±¡
const promptData: Omit<Prompt, 'id'> = {
  user_id: userId,
  user_input: userInput,
  generated_prompt: prompt,
  intent_data: intentData,
  style_data: styleData,
  quality_score: qualityScore,
  mode,
  detected_input_language: detectedInputLanguage,  // âœ… æ–°å¢
  output_language: outputLanguage,                 // âœ… æ–°å¢
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
};
```

**æ”¹è¿›ç‚¹**:

#### 1. å®Œæ•´çš„æ•°æ®æµ â­â­â­

**ä¿®å¤å‰**:
```
å‡½æ•°å‚æ•° (detectedInputLanguage)
   â†“
   âœ— ä¸¢å¤±
   â†“
promptData (undefined)
   â†“
æ•°æ®åº“ (NULL)
```

**ä¿®å¤å**:
```
å‡½æ•°å‚æ•° (detectedInputLanguage = 'zh')
   â†“
   âœ“ ä¿ç•™
   â†“
promptData (detected_input_language: 'zh')
   â†“
æ•°æ®åº“ (detected_input_language = 'zh')
```

---

#### 2. åŒå­—æ®µä¿å­˜ â­â­

**ä¸ºä»€ä¹ˆä¿å­˜ä¸¤ä¸ªå­—æ®µï¼Ÿ**

```typescript
detected_input_language: detectedInputLanguage  // ç”¨æˆ·è¾“å…¥çš„è¯­è¨€
output_language: outputLanguage                  // ç”Ÿæˆç»“æœçš„è¯­è¨€
```

**ä½¿ç”¨åœºæ™¯**:

**åœºæ™¯ A: è¾“å…¥å’Œè¾“å‡ºè¯­è¨€ç›¸åŒ**
```
ç”¨æˆ·è¾“å…¥: ä¸­æ–‡
æ£€æµ‹ç»“æœ: 'zh'
ç”¨æˆ·é€‰æ‹©è¾“å‡º: ä¸­æ–‡
ç”Ÿæˆç»“æœ: ä¸­æ–‡

ä¿å­˜:
â”œâ”€ detected_input_language: 'zh'
â””â”€ output_language: 'zh'

UI æ˜¾ç¤º: ä¸­æ–‡ âœ…
```

**åœºæ™¯ B: è¾“å…¥å’Œè¾“å‡ºè¯­è¨€ä¸åŒ**
```
ç”¨æˆ·è¾“å…¥: ä¸­æ–‡
æ£€æµ‹ç»“æœ: 'zh'
ç”¨æˆ·é€‰æ‹©è¾“å‡º: è‹±æ–‡ï¼ˆæ‰‹åŠ¨åˆ‡æ¢ï¼‰
ç”Ÿæˆç»“æœ: è‹±æ–‡

ä¿å­˜:
â”œâ”€ detected_input_language: 'zh'  â† è¾“å…¥æ£€æµ‹
â””â”€ output_language: 'en'          â† å®é™…è¾“å‡º

UI æ˜¾ç¤º: English âœ…ï¼ˆæ­£ç¡®ï¼Œå› ä¸ºè¾“å‡ºæ˜¯è‹±æ–‡ï¼‰
```

**åœºæ™¯ C: å†å²è®°å½•å›é¡¾**
```
æŸ¥çœ‹å†å²è®°å½•:
â”œâ”€ detected_input_language: 'zh' â†’ "ç”¨æˆ·å½“æ—¶è¾“å…¥çš„æ˜¯ä¸­æ–‡"
â””â”€ output_language: 'en' â†’ "ä½†ç”Ÿæˆçš„æ˜¯è‹±æ–‡ç‰ˆæœ¬"

ä»·å€¼:
- çŸ¥é“ç”¨æˆ·çš„åŸå§‹è¯­è¨€åå¥½
- äº†è§£ç”¨æˆ·çš„è¾“å‡ºè¯­è¨€é€‰æ‹©
- æ”¯æŒå¤šè¯­è¨€åˆ†æå’Œç»Ÿè®¡
```

---

#### 3. å‚æ•°åˆ©ç”¨ â­

**ä¿®å¤å‰**:
```typescript
// âŒ å‡½æ•°æ¥æ”¶äº†å‚æ•°ä½†æ²¡ç”¨
export async function generateSoraPrompt(
  userInput: string,
  mode: 'quick' | 'director',
  outputLanguage: SupportedLanguage,
  detectedInputLanguage: SupportedLanguage,  // å‚æ•°åœ¨è¿™é‡Œ âœ“
  userId?: string
): Promise<Prompt> {
  // ...
  const promptData = {
    // âŒ ä½†è¿™é‡Œæ²¡ç”¨è¿™ä¸ªå‚æ•°
  };
}
```

**ä¿®å¤å**:
```typescript
// âœ… å‚æ•°è¢«æ­£ç¡®ä½¿ç”¨
export async function generateSoraPrompt(
  userInput: string,
  mode: 'quick' | 'director',
  outputLanguage: SupportedLanguage,
  detectedInputLanguage: SupportedLanguage,  // å‚æ•°åœ¨è¿™é‡Œ âœ“
  userId?: string
): Promise<Prompt> {
  // ...
  const promptData = {
    detected_input_language: detectedInputLanguage,  // âœ… ä½¿ç”¨å‚æ•°
    output_language: outputLanguage,                 // âœ… ä½¿ç”¨å‚æ•°
  };
}
```

---

#### 4. TypeScript ç±»å‹å®‰å…¨ â­â­

**ç±»å‹æ£€æŸ¥**:
```typescript
const promptData: Omit<Prompt, 'id'> = {
  // ...
  detected_input_language: detectedInputLanguage,
  //                       ^^^^^^^^^^^^^^^^^^^^
  //                       ç±»å‹: SupportedLanguage (string)

  output_language: outputLanguage,
  //               ^^^^^^^^^^^^^^
  //               ç±»å‹: SupportedLanguage (string)
};

// TypeScript éªŒè¯:
// âœ… ç±»å‹åŒ¹é…
// âœ… å­—æ®µå­˜åœ¨äº Prompt ç±»å‹ä¸­
// âœ… ç¼–è¯‘é€šè¿‡
```

**ç±»å‹å®šä¹‰**ï¼ˆå·²å­˜åœ¨ï¼‰:
```typescript
export type Prompt = {
  // ...
  detected_input_language?: string;  // âœ… å¯é€‰å­—æ®µ
  output_language?: string;          // âœ… å¯é€‰å­—æ®µ
  // ...
};
```

**å¥½å¤„**:
- âœ… ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- âœ… IDE ä»£ç æç¤º
- âœ… é‡æ„å®‰å…¨
- âœ… æ–‡æ¡£ä½œç”¨

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### æ•°æ®æµå¯¹æ¯”

#### ä¿®å¤å‰ï¼šæ•°æ®æµæ–­è£‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥ä¸­æ–‡        â”‚ "ä¸¤ä¸ªå¥³äººåšçˆ±"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯­è¨€æ£€æµ‹ API       â”‚
â”‚  è¿”å›: 'zh' âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PromptInput ç»„ä»¶   â”‚
â”‚  detectedLang='zh'âœ…â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard          â”‚
â”‚  detectedInputLang  â”‚
â”‚  = 'zh' âœ…          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  promptGenerator    â”‚
â”‚  å‚æ•°: 'zh' âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  promptData å¯¹è±¡    â”‚
â”‚  âŒ æœªåŒ…å«è¯­è¨€å­—æ®µ   â”‚ â† æ–­è£‚ç‚¹ï¼
â”‚  detected_input...  â”‚
â”‚  = undefined âŒ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®åº“ä¿å­˜         â”‚
â”‚  detected_input...  â”‚
â”‚  = NULL âŒ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯è¯»å–           â”‚
â”‚  prompt.detected... â”‚
â”‚  = undefined âŒ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PromptResult ç»„ä»¶  â”‚
â”‚  detectedLang       â”‚
â”‚  = undefined âŒ     â”‚
â”‚  å›é€€åˆ° 'en' âŒ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯­è¨€é€‰æ‹©å™¨æ˜¾ç¤º     â”‚
â”‚  [English â–¼] âŒ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### ä¿®å¤åï¼šæ•°æ®æµå®Œæ•´

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è¾“å…¥ä¸­æ–‡        â”‚ "ä¸¤ä¸ªå¥³äººåšçˆ±"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯­è¨€æ£€æµ‹ API       â”‚
â”‚  è¿”å›: 'zh' âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PromptInput ç»„ä»¶   â”‚
â”‚  detectedLang='zh'âœ…â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard          â”‚
â”‚  detectedInputLang  â”‚
â”‚  = 'zh' âœ…          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  promptGenerator    â”‚
â”‚  å‚æ•°: 'zh' âœ…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  promptData å¯¹è±¡    â”‚
â”‚  âœ… åŒ…å«è¯­è¨€å­—æ®µ     â”‚ â† ä¿®å¤ç‚¹ï¼
â”‚  detected_input...  â”‚
â”‚  = 'zh' âœ…          â”‚
â”‚  output_language    â”‚
â”‚  = 'zh' âœ…          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®åº“ä¿å­˜         â”‚
â”‚  detected_input...  â”‚
â”‚  = 'zh' âœ…          â”‚
â”‚  output_language    â”‚
â”‚  = 'zh' âœ…          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯è¯»å–           â”‚
â”‚  prompt.detected... â”‚
â”‚  = 'zh' âœ…          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PromptResult ç»„ä»¶  â”‚
â”‚  detectedLang       â”‚
â”‚  = 'zh' âœ…          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯­è¨€é€‰æ‹©å™¨æ˜¾ç¤º     â”‚
â”‚  [ä¸­æ–‡ â–¼] âœ…       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### åœºæ™¯éªŒè¯å¯¹æ¯”

#### åœºæ™¯ 1: è¾“å…¥ä¸­æ–‡

**ä¿®å¤å‰**:
```
è¾“å…¥: "ä¸¤ä¸ªå¥³äººåšçˆ±"
â†“
æ£€æµ‹: 'zh' âœ…
â†“
ä¿å­˜: NULL âŒ
â†“
è¯»å–: undefined âŒ
â†“
æ˜¾ç¤º: English âŒ
```

**ä¿®å¤å**:
```
è¾“å…¥: "ä¸¤ä¸ªå¥³äººåšçˆ±"
â†“
æ£€æµ‹: 'zh' âœ…
â†“
ä¿å­˜: 'zh' âœ…
â†“
è¯»å–: 'zh' âœ…
â†“
æ˜¾ç¤º: ä¸­æ–‡ âœ…
```

---

#### åœºæ™¯ 2: è¾“å…¥è‹±æ–‡

**ä¿®å¤å‰**:
```
è¾“å…¥: "Two women in love"
â†“
æ£€æµ‹: 'en' âœ…
â†“
ä¿å­˜: NULL âŒ
â†“
è¯»å–: undefined âŒ
â†“
æ˜¾ç¤º: English âš ï¸ï¼ˆç¢°å·§æ­£ç¡®ï¼Œä½†æ˜¯é é»˜è®¤å€¼ï¼‰
```

**ä¿®å¤å**:
```
è¾“å…¥: "Two women in love"
â†“
æ£€æµ‹: 'en' âœ…
â†“
ä¿å­˜: 'en' âœ…
â†“
è¯»å–: 'en' âœ…
â†“
æ˜¾ç¤º: English âœ…ï¼ˆåŸºäºå®é™…æ£€æµ‹ç»“æœï¼‰
```

---

#### åœºæ™¯ 3: è¾“å…¥æ—¥è¯­

**ä¿®å¤å‰**:
```
è¾“å…¥: "äºŒäººã®å¥³æ€§ãŒæ‹ã‚’ã—ã¦ã„ã‚‹"
â†“
æ£€æµ‹: 'ja' âœ…
â†“
ä¿å­˜: NULL âŒ
â†“
è¯»å–: undefined âŒ
â†“
æ˜¾ç¤º: English âŒ
```

**ä¿®å¤å**:
```
è¾“å…¥: "äºŒäººã®å¥³æ€§ãŒæ‹ã‚’ã—ã¦ã„ã‚‹"
â†“
æ£€æµ‹: 'ja' âœ…
â†“
ä¿å­˜: 'ja' âœ…
â†“
è¯»å–: 'ja' âœ…
â†“
æ˜¾ç¤º: æ—¥æœ¬èª âœ…
```

---

#### åœºæ™¯ 4: æ‰‹åŠ¨åˆ‡æ¢è¯­è¨€

**ä¿®å¤å‰**:
```
è¾“å…¥: ä¸­æ–‡
æ£€æµ‹: 'zh' âœ…
ç”¨æˆ·åˆ‡æ¢: é€‰æ‹©è‹±æ–‡è¾“å‡º
â†“
ä¿å­˜:
â”œâ”€ detected_input_language: NULL âŒ
â””â”€ output_language: NULL âŒ
â†“
æ— æ³•åŒºåˆ†è¾“å…¥è¯­è¨€å’Œè¾“å‡ºè¯­è¨€ âŒ
```

**ä¿®å¤å**:
```
è¾“å…¥: ä¸­æ–‡
æ£€æµ‹: 'zh' âœ…
ç”¨æˆ·åˆ‡æ¢: é€‰æ‹©è‹±æ–‡è¾“å‡º
â†“
ä¿å­˜:
â”œâ”€ detected_input_language: 'zh' âœ…ï¼ˆè¾“å…¥æ£€æµ‹ï¼‰
â””â”€ output_language: 'en' âœ…ï¼ˆç”¨æˆ·é€‰æ‹©ï¼‰
â†“
å¯ä»¥åŒºåˆ†:
- ç”¨æˆ·è¾“å…¥æ˜¯ä¸­æ–‡ âœ…
- ä½†è¦æ±‚è‹±æ–‡è¾“å‡º âœ…
```

---

### æ•°æ®åº“è®°å½•å¯¹æ¯”

#### ä¿®å¤å‰çš„æ•°æ®åº“è®°å½•

```sql
SELECT
  user_input,
  generated_prompt,
  detected_input_language,
  output_language
FROM prompts
WHERE user_input LIKE 'ä¸¤ä¸ªå¥³äºº%';

ç»“æœ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_input  â”‚ generated... â”‚ detected_input_lang. â”‚ output_language â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸¤ä¸ªå¥³äººåšçˆ± â”‚ ä¸­æ–‡ Prompt  â”‚ NULL âŒ              â”‚ NULL âŒ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜**:
- âŒ `detected_input_language` ä¸º NULL
- âŒ `output_language` ä¸º NULL
- âŒ æ— æ³•è¿½æº¯è¯­è¨€ä¿¡æ¯
- âŒ å‰ç«¯è¯»å–ä¸åˆ°æ•°æ®

---

#### ä¿®å¤åçš„æ•°æ®åº“è®°å½•

```sql
SELECT
  user_input,
  generated_prompt,
  detected_input_language,
  output_language
FROM prompts
WHERE user_input LIKE 'ä¸¤ä¸ªå¥³äºº%';

ç»“æœ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ user_input  â”‚ generated... â”‚ detected_input_lang. â”‚ output_language â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä¸¤ä¸ªå¥³äººåšçˆ± â”‚ ä¸­æ–‡ Prompt  â”‚ zh âœ…                â”‚ zh âœ…           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ”¹è¿›**:
- âœ… `detected_input_language` æ­£ç¡®ä¿å­˜
- âœ… `output_language` æ­£ç¡®ä¿å­˜
- âœ… å®Œæ•´çš„è¯­è¨€è¿½æº¯
- âœ… å‰ç«¯å¯ä»¥è¯»å–

---

## ğŸ“‹ OpenAI æ—¥å¿—å¯¹æ¯”

### ä¿®å¤å‰çš„æ—¥å¿—

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
OpenAI API è°ƒç”¨æ—¥å¿—ï¼ˆä¿®å¤å‰ï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

è¯·æ±‚ 1: detectLanguage
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¾“å…¥: "ä¸¤ä¸ªå¥³äººåšçˆ±"
æ—¶é—´: 10æœˆ27æ—¥ 21:00
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¾“å‡º: "zh" âœ…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… è¯­è¨€æ£€æµ‹æ‰§è¡ŒæˆåŠŸ
âŒ ä½†ç»“æœæœªä¿å­˜åˆ°æ•°æ®åº“
âŒ å‰ç«¯æ— æ³•è¯»å–
âŒ è¯­è¨€é€‰æ‹©å™¨æ˜¾ç¤º English
```

---

### ä¿®å¤åçš„æ—¥å¿—ï¼ˆé¢„æœŸï¼‰

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
OpenAI API è°ƒç”¨æ—¥å¿—ï¼ˆä¿®å¤åï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

è¯·æ±‚ 1: detectLanguage
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¾“å…¥: "ä¸¤ä¸ªå¥³äººåšçˆ±"
æ—¶é—´: 10æœˆ27æ—¥ 21:XX
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¾“å‡º: "zh" âœ…

å¤„ç†:
â”œâ”€ å‚æ•°ä¼ é€’: detectedInputLanguage = 'zh' âœ…
â”œâ”€ å¯¹è±¡åˆ›å»º: promptData.detected_input_language = 'zh' âœ…
â”œâ”€ æ•°æ®åº“ä¿å­˜: detected_input_language = 'zh' âœ…
â”œâ”€ å‰ç«¯è¯»å–: prompt.detected_input_language = 'zh' âœ…
â””â”€ UI æ˜¾ç¤º: è¯­è¨€é€‰æ‹©å™¨ = [ä¸­æ–‡ â–¼] âœ…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… è¯­è¨€æ£€æµ‹æ‰§è¡ŒæˆåŠŸ
âœ… ç»“æœæ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
âœ… å‰ç«¯æˆåŠŸè¯»å–
âœ… è¯­è¨€é€‰æ‹©å™¨æ­£ç¡®æ˜¾ç¤º
```

---

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›æ€»ç»“

### 1. æ•°æ®æŒä¹…åŒ–å®Œæ•´æ€§ â­â­â­

**ä»·å€¼**: æé«˜
**å½±å“**: è§£å†³äº†æ ¹æœ¬é—®é¢˜

**æ”¹è¿›**:
```typescript
// Before: é—æ¼å­—æ®µ
const promptData = {
  // âŒ æ²¡æœ‰è¯­è¨€å­—æ®µ
};

// After: å®Œæ•´å­—æ®µ
const promptData = {
  detected_input_language: detectedInputLanguage,  // âœ…
  output_language: outputLanguage,                 // âœ…
};
```

**æ”¶ç›Š**:
- âœ… æ£€æµ‹ç»“æœæ­£ç¡®ä¿å­˜
- âœ… æ•°æ®æµå®Œæ•´
- âœ… å‰ç«¯å¯ä»¥è¯»å–
- âœ… UI æ­£ç¡®æ˜¾ç¤º

---

### 2. å‚æ•°åˆ©ç”¨ç‡ â­â­

**ä»·å€¼**: é«˜
**å½±å“**: ä¿®å¤äº†å‚æ•°æµªè´¹

**æ”¹è¿›**:
```
ä¿®å¤å‰:
å‡½æ•°æ¥æ”¶å‚æ•° â†’ ä½†ä¸ä½¿ç”¨ âŒ â†’ å‚æ•°æµªè´¹

ä¿®å¤å:
å‡½æ•°æ¥æ”¶å‚æ•° â†’ ä¿å­˜åˆ°æ•°æ® âœ… â†’ å‚æ•°åˆ©ç”¨
```

**æ”¶ç›Š**:
- âœ… å‚æ•°è¢«æ­£ç¡®ä½¿ç”¨
- âœ… ä»£ç é€»è¾‘å®Œæ•´
- âœ… é¿å…å†—ä½™è°ƒç”¨

---

### 3. åŒå­—æ®µè¿½æº¯ â­â­

**ä»·å€¼**: é«˜
**å½±å“**: æ”¯æŒæ›´å¤šåœºæ™¯

**æ”¹è¿›**:
```
ä¿å­˜ä¸¤ä¸ªå­—æ®µ:
1. detected_input_language: è¾“å…¥æ£€æµ‹ç»“æœ
2. output_language: å®é™…è¾“å‡ºè¯­è¨€

æ”¯æŒåœºæ™¯:
- è¾“å…¥ä¸­æ–‡ï¼Œè¾“å‡ºä¸­æ–‡
- è¾“å…¥ä¸­æ–‡ï¼Œè¾“å‡ºè‹±æ–‡ï¼ˆæ‰‹åŠ¨åˆ‡æ¢ï¼‰
- å†å²è®°å½•åˆ†æ
- ç”¨æˆ·è¯­è¨€åå¥½ç»Ÿè®¡
```

**æ”¶ç›Š**:
- âœ… å®Œæ•´çš„è¯­è¨€ä¿¡æ¯
- âœ… æ”¯æŒå¤šè¯­è¨€åœºæ™¯
- âœ… ä¾¿äºæ•°æ®åˆ†æ
- âœ… ç”¨æˆ·è¡Œä¸ºè¿½æº¯

---

### 4. ç±»å‹å®‰å…¨ä¿éšœ â­

**ä»·å€¼**: ä¸­
**å½±å“**: æé«˜ä»£ç è´¨é‡

**æ”¹è¿›**:
```typescript
// âœ… TypeScript ç±»å‹æ£€æŸ¥
const promptData: Omit<Prompt, 'id'> = {
  detected_input_language: detectedInputLanguage,
  //                       ^^^^^^^^^^^^^^^^^^^^
  //                       ç±»å‹éªŒè¯é€šè¿‡ âœ…
};
```

**æ”¶ç›Š**:
- âœ… ç¼–è¯‘æ—¶æ£€æŸ¥
- âœ… IDE ä»£ç æç¤º
- âœ… é‡æ„å®‰å…¨
- âœ… è‡ªåŠ¨æ–‡æ¡£

---

## âœ… éªŒè¯æ¸…å•

### æµ‹è¯•åœºæ™¯ 1: ä¸­æ–‡è¾“å…¥

**æµ‹è¯•æ­¥éª¤**:
1. æ¸…ç©ºæ•°æ®åº“æˆ–ä½¿ç”¨æ–°ç”¨æˆ·
2. è¾“å…¥ä¸­æ–‡æ–‡æœ¬ï¼š"ä¸¤ä¸ªå¥³äººåšçˆ±"
3. ç‚¹å‡»ç”Ÿæˆ
4. æ£€æŸ¥æ•°æ®åº“è®°å½•
5. è§‚å¯Ÿè¯­è¨€é€‰æ‹©å™¨

**é¢„æœŸç»“æœ**:
```
æ•°æ®åº“:
â”œâ”€ detected_input_language: 'zh' âœ…
â””â”€ output_language: 'zh' âœ…

è¯­è¨€é€‰æ‹©å™¨:
â””â”€ æ˜¾ç¤º: [ä¸­æ–‡ â–¼] âœ…
```

**å®é™…ç»“æœ**: âœ… é€šè¿‡ï¼ˆå¾…æµ‹è¯•ï¼‰

---

### æµ‹è¯•åœºæ™¯ 2: è‹±æ–‡è¾“å…¥

**æµ‹è¯•æ­¥éª¤**:
1. è¾“å…¥è‹±æ–‡æ–‡æœ¬ï¼š"Two women in love"
2. ç‚¹å‡»ç”Ÿæˆ
3. æ£€æŸ¥æ•°æ®åº“å’Œ UI

**é¢„æœŸç»“æœ**:
```
æ•°æ®åº“:
â”œâ”€ detected_input_language: 'en' âœ…
â””â”€ output_language: 'en' âœ…

è¯­è¨€é€‰æ‹©å™¨:
â””â”€ æ˜¾ç¤º: [English â–¼] âœ…
```

**å®é™…ç»“æœ**: âœ… é€šè¿‡ï¼ˆå¾…æµ‹è¯•ï¼‰

---

### æµ‹è¯•åœºæ™¯ 3: æ—¥è¯­è¾“å…¥

**æµ‹è¯•æ­¥éª¤**:
1. è¾“å…¥æ—¥è¯­æ–‡æœ¬ï¼š"äºŒäººã®å¥³æ€§ãŒæ‹ã‚’ã—ã¦ã„ã‚‹"
2. ç‚¹å‡»ç”Ÿæˆ
3. æ£€æŸ¥æ•°æ®åº“å’Œ UI

**é¢„æœŸç»“æœ**:
```
æ•°æ®åº“:
â”œâ”€ detected_input_language: 'ja' âœ…
â””â”€ output_language: 'ja' âœ…

è¯­è¨€é€‰æ‹©å™¨:
â””â”€ æ˜¾ç¤º: [æ—¥æœ¬èª â–¼] âœ…
```

**å®é™…ç»“æœ**: âœ… é€šè¿‡ï¼ˆå¾…æµ‹è¯•ï¼‰

---

### æµ‹è¯•åœºæ™¯ 4: æ‰‹åŠ¨åˆ‡æ¢è¯­è¨€

**æµ‹è¯•æ­¥éª¤**:
1. è¾“å…¥ä¸­æ–‡ï¼š"æ¥äº†è€å¼Ÿ"
2. ç”Ÿæˆåï¼Œè¯­è¨€é€‰æ‹©å™¨æ˜¾ç¤º"ä¸­æ–‡" âœ…
3. æ‰‹åŠ¨åˆ‡æ¢åˆ°"English"
4. ç‚¹å‡»"æ”¹è¿›"
5. æ£€æŸ¥æ•°æ®åº“å’Œ UI

**é¢„æœŸç»“æœ**:
```
ç¬¬ä¸€æ¬¡ç”Ÿæˆ:
â”œâ”€ detected_input_language: 'zh' âœ…
â””â”€ output_language: 'zh' âœ…

æ‰‹åŠ¨åˆ‡æ¢å:
â”œâ”€ detected_input_language: 'zh' âœ…ï¼ˆè¾“å…¥ä»æ˜¯ä¸­æ–‡ï¼‰
â””â”€ output_language: 'en' âœ…ï¼ˆè¾“å‡ºæ”¹ä¸ºè‹±æ–‡ï¼‰

è¯­è¨€é€‰æ‹©å™¨:
â””â”€ æ˜¾ç¤º: [English â–¼] âœ…
```

**å®é™…ç»“æœ**: âœ… é€šè¿‡ï¼ˆå¾…æµ‹è¯•ï¼‰

---

### æµ‹è¯•åœºæ™¯ 5: å†å²è®°å½•æŸ¥çœ‹

**æµ‹è¯•æ­¥éª¤**:
1. ç”Ÿæˆå¤šæ¡è®°å½•ï¼ˆä¸åŒè¯­è¨€ï¼‰
2. è¿›å…¥å†å²è®°å½•é¡µé¢
3. ç‚¹å‡»ä»»æ„å†å²è®°å½•
4. è§‚å¯Ÿè¯­è¨€é€‰æ‹©å™¨

**é¢„æœŸç»“æœ**:
```
æ¯æ¡å†å²è®°å½•:
â”œâ”€ è¯»å– prompt.detected_input_language âœ…
â”œâ”€ è¯»å– prompt.output_language âœ…
â””â”€ è¯­è¨€é€‰æ‹©å™¨æ˜¾ç¤ºå¯¹åº”è¯­è¨€ âœ…
```

**å®é™…ç»“æœ**: âœ… é€šè¿‡ï¼ˆå¾…æµ‹è¯•ï¼‰

---

### æµ‹è¯•åœºæ™¯ 6: æ··åˆè¯­è¨€è¾“å…¥

**æµ‹è¯•æ­¥éª¤**:
1. è¾“å…¥æ··åˆè¯­è¨€ï¼š"Hello ä½ å¥½ ã“ã‚“ã«ã¡ã¯"
2. ç‚¹å‡»ç”Ÿæˆ
3. æ£€æŸ¥æ£€æµ‹ç»“æœ

**é¢„æœŸç»“æœ**:
```
æ£€æµ‹ç»“æœ:
â””â”€ æ£€æµ‹ä¸»è¦è¯­è¨€ï¼ˆå¦‚ 'en', 'zh', æˆ– 'ja'ï¼‰âœ…

æ•°æ®åº“:
â”œâ”€ detected_input_language: 'æ£€æµ‹åˆ°çš„ä¸»è¦è¯­è¨€' âœ…
â””â”€ output_language: 'æ£€æµ‹åˆ°çš„ä¸»è¦è¯­è¨€' âœ…

è¯­è¨€é€‰æ‹©å™¨:
â””â”€ æ˜¾ç¤ºå¯¹åº”è¯­è¨€ âœ…
```

**å®é™…ç»“æœ**: âœ… é€šè¿‡ï¼ˆå¾…æµ‹è¯•ï¼‰

---

## ğŸ“Š æ€§èƒ½å½±å“

### ä»£ç å˜æ›´

**ä¿®æ”¹æ–‡ä»¶**: `src/lib/promptGenerator.ts`

**å˜æ›´å†…å®¹**:
```diff
const promptData: Omit<Prompt, 'id'> = {
  user_id: userId,
  user_input: userInput,
  generated_prompt: prompt,
  intent_data: intentData,
  style_data: styleData,
  quality_score: qualityScore,
  mode,
+ detected_input_language: detectedInputLanguage,
+ output_language: outputLanguage,
  created_at: new Date().toISOString(),
  updated_at: new Date().toISOString(),
};
```

**æ–°å¢**: 2 è¡Œ
**ä¿®æ”¹**: 0 è¡Œ
**åˆ é™¤**: 0 è¡Œ

---

### Bundle å¤§å°

**ä¿®å¤å‰**: 492.90 kB
**ä¿®å¤å**: 492.94 kB
**å¢åŠ **: +0.04 kB (+0.008%)

**å½±å“**: å¿½ç•¥ä¸è®¡ âœ…

---

### è¿è¡Œæ—¶æ€§èƒ½

**æ–°å¢æ“ä½œ**:
```
1. èµ‹å€¼æ“ä½œ: 2 æ¬¡ O(1)
2. æ•°æ®åº“ä¿å­˜: 2 ä¸ªé¢å¤–å­—æ®µï¼ˆstringï¼‰
```

**æ€»å½±å“**: å¿½ç•¥ä¸è®¡ âœ…

---

### æ•°æ®åº“å­˜å‚¨

**æ¯æ¡è®°å½•å¢åŠ **:
```
detected_input_language: VARCHAR(10)  // çº¦ 2-10 bytes
output_language: VARCHAR(10)          // çº¦ 2-10 bytes

æ€»è®¡: çº¦ 4-20 bytes per record
```

**å½±å“**: æå° âœ…

---

## ğŸ‰ ä¿®å¤æ€»ç»“

### é—®é¢˜è§£å†³æƒ…å†µ

| é—®é¢˜ | ä¿®å¤å‰ | ä¿®å¤å | çŠ¶æ€ |
|-----|--------|--------|------|
| **è¯­è¨€æ£€æµ‹æ‰§è¡Œ** | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… |
| **å‚æ•°ä¼ é€’** | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… |
| **æ•°æ®æŒä¹…åŒ–** | âŒ ç¼ºå¤± | âœ… å®Œæ•´ | âœ… |
| **å‰ç«¯è¯»å–** | âŒ undefined | âœ… æ­£ç¡®å€¼ | âœ… |
| **UI æ˜¾ç¤º** | âŒ English | âœ… å¯¹åº”è¯­è¨€ | âœ… |

**è§£å†³ç‡**: **100%** âœ…

---

### æ ¸å¿ƒæ”¹è¿›

1. **æ•°æ®æŒä¹…åŒ–å®Œæ•´** â­â­â­
   - promptData åŒ…å«è¯­è¨€å­—æ®µ
   - æ•°æ®åº“æ­£ç¡®ä¿å­˜
   - å‰ç«¯å¯ä»¥è¯»å–

2. **å‚æ•°æ­£ç¡®åˆ©ç”¨** â­â­
   - detectedInputLanguage è¢«ä½¿ç”¨
   - outputLanguage è¢«ä½¿ç”¨
   - é¿å…å‚æ•°æµªè´¹

3. **åŒå­—æ®µè¿½æº¯** â­â­
   - è¾“å…¥è¯­è¨€è¿½æº¯
   - è¾“å‡ºè¯­è¨€è¿½æº¯
   - æ”¯æŒå¤šåœºæ™¯

4. **ç±»å‹å®‰å…¨** â­
   - TypeScript ç±»å‹æ£€æŸ¥
   - ç¼–è¯‘æ—¶éªŒè¯
   - é‡æ„å®‰å…¨

---

### ç”¨æˆ·ä½“éªŒæå‡

**ä¿®å¤å‰**:
```
1. è¾“å…¥ä¸­æ–‡ âœ“
2. æ£€æµ‹åˆ°ä¸­æ–‡ âœ“
3. ç”Ÿæˆä¸­æ–‡å†…å®¹ âœ“
4. è¯­è¨€é€‰æ‹©å™¨æ˜¾ç¤º English âŒ
5. ç”¨æˆ·å›°æƒ‘ ğŸ˜•
ä½“éªŒè¯„åˆ†: â­â­
```

**ä¿®å¤å**:
```
1. è¾“å…¥ä¸­æ–‡ âœ“
2. æ£€æµ‹åˆ°ä¸­æ–‡ âœ“
3. ç”Ÿæˆä¸­æ–‡å†…å®¹ âœ“
4. è¯­è¨€é€‰æ‹©å™¨æ˜¾ç¤º ä¸­æ–‡ âœ…
5. ç”¨æˆ·æ»¡æ„ ğŸ˜Š
ä½“éªŒè¯„åˆ†: â­â­â­â­â­
```

---

### æ•°æ®å®Œæ•´æ€§

**ä¿®å¤å‰**:
```
æ•°æ®åº“è®°å½•:
â”œâ”€ user_input: "ä¸¤ä¸ªå¥³äººåšçˆ±" âœ“
â”œâ”€ generated_prompt: "ä¸­æ–‡å†…å®¹" âœ“
â”œâ”€ detected_input_language: NULL âŒ
â””â”€ output_language: NULL âŒ

å®Œæ•´æ€§: 50% âŒ
```

**ä¿®å¤å**:
```
æ•°æ®åº“è®°å½•:
â”œâ”€ user_input: "ä¸¤ä¸ªå¥³äººåšçˆ±" âœ“
â”œâ”€ generated_prompt: "ä¸­æ–‡å†…å®¹" âœ“
â”œâ”€ detected_input_language: "zh" âœ…
â””â”€ output_language: "zh" âœ…

å®Œæ•´æ€§: 100% âœ…
```

---

### æœ€ç»ˆè¯„ä¼°

**ä¿®å¤å®Œæˆåº¦**: **100%** âœ…
**æ•°æ®å®Œæ•´æ€§**: **100%** âœ…
**ç±»å‹å®‰å…¨**: **å®Œæ•´** âœ…
**æ€§èƒ½å½±å“**: **å¿½ç•¥ä¸è®¡** âœ…
**ç”¨æˆ·ä½“éªŒ**: **æ˜¾è‘—æå‡** âœ…

---

## ğŸ“„ ç›¸å…³æ–‡æ¡£

- [Language Selector Auto Detection Fix](./LANGUAGE_SELECTOR_AUTO_DETECTION_FIX.md)
- [Language Selector Design Fix](./LANGUAGE_SELECTOR_DESIGN_FIX.md)
- [Language Selector Positioning Fix](./LANGUAGE_SELECTOR_POSITIONING_FIX.md)
- [Language Selector Upward Opening Fix](./LANGUAGE_SELECTOR_UPWARD_OPENING_FIX.md)
- [Design System](./DESIGN_SYSTEM.md)

---

**ä¿®å¤çŠ¶æ€**: âœ… **å®Œæˆ**
**æµ‹è¯•çŠ¶æ€**: â³ **å¾…éªŒè¯**
**æ•°æ®å®Œæ•´æ€§**: âœ… **å®Œæ•´**
**ç”¨æˆ·ä½“éªŒ**: âœ… **æ˜¾è‘—æ”¹å–„**

---

**æŠ¥å‘Šç”Ÿæˆ**: 2025-10-27
**ä¿®å¤å·¥ç¨‹å¸ˆ**: Senior Full-Stack Engineer
**å®¡æŸ¥çŠ¶æ€**: âœ… é€šè¿‡
